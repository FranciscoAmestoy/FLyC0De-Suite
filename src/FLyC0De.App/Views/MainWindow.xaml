<Window x:Class="FLyC0De.App.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:tb="http://www.hardcodet.net/taskbar"
        mc:Ignorable="d"
        Title="FLyC0De Suite" 
        Height="720" Width="1200"
        MinHeight="650" MinWidth="1000"
        WindowStartupLocation="CenterScreen"
        Background="{StaticResource MainBackgroundBrush}"
        Icon="/Resources/Logo.ico"
        Loaded="Window_Loaded"
        Closing="Window_Closing">

    <Window.Resources>
        <ContextMenu x:Key="TrayMenu">
            <MenuItem Header="Open" Click="TrayOpen_Click"/>
            <Separator/>
            <MenuItem Header="Exit" Click="TrayExit_Click"/>
        </ContextMenu>
    </Window.Resources>

    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <tb:TaskbarIcon x:Name="MyNotifyIcon"
                        IconSource="/Resources/Logo.ico"
                        ToolTipText="FLyC0De Suite"
                        Visibility="Visible"
                        DoubleClickCommand="{Binding ShowWindowCommand}" 
                        TrayMouseDoubleClick="MyNotifyIcon_TrayMouseDoubleClick"
                        ContextMenu="{StaticResource TrayMenu}"/>
        
        <!-- Header -->
        <Grid Grid.Row="0" Margin="0,0,0,8">
            <Grid.Effect>
                <DropShadowEffect BlurRadius="10" ShadowDepth="2" Opacity="0.3"/>
            </Grid.Effect>
            <Border Background="{StaticResource HeaderBackgroundBrush}" CornerRadius="5" BorderBrush="#909090" BorderThickness="1" Padding="12">
                <Grid>
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                        <Image Source="/Resources/Logo.png" Width="48" Height="48" Margin="0,0,16,0" RenderOptions.BitmapScalingMode="HighQuality"/>
                        <StackPanel VerticalAlignment="Center">
                            <TextBlock Text="{DynamicResource AppTitle}" FontSize="24" FontWeight="Bold" Foreground="{StaticResource TextBrush}">
                                <TextBlock.Effect>
                                    <DropShadowEffect BlurRadius="2" ShadowDepth="1" Opacity="0.5" Color="White"/>
                                </TextBlock.Effect>
                            </TextBlock>
                            <TextBlock Text="{DynamicResource App_Subtitle}" FontSize="12" Foreground="{StaticResource TextBrush}" FontStyle="Italic" Opacity="0.8"/>
                        </StackPanel>
                    </StackPanel>
                    
                    <Button x:Name="SettingsButton" Click="SettingsButton_Click" HorizontalAlignment="Right" VerticalAlignment="Top" Padding="8,4" Content="{DynamicResource Btn_Settings}"/>
                </Grid>
            </Border>
        </Grid>

        <!-- Main Content -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="280"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- LEFT PANEL: Modules -->
            <GroupBox Grid.Column="0" Header="{DynamicResource Main_Modules}" Margin="0,0,8,0">
                 <ListBox x:Name="ModulesListBox" HorizontalContentAlignment="Stretch" SelectionChanged="ModulesListBox_SelectionChanged" Background="#F4F4F4" BorderBrush="#A0A0A0" ScrollViewer.HorizontalScrollBarVisibility="Disabled" Padding="0">
                     <ListBox.ItemTemplate>
                         <DataTemplate>
                             <Border Background="{StaticResource PanelBackgroundBrush}" BorderThickness="1" BorderBrush="{StaticResource AccentBrush}" CornerRadius="4" Margin="2,1" Padding="6,4">
                                 <Grid>
                                     <Grid.ColumnDefinitions>
                                         <ColumnDefinition Width="Auto"/>
                                         <ColumnDefinition Width="*"/>
                                         <ColumnDefinition Width="Auto"/>
                                     </Grid.ColumnDefinitions>
                                     
                                     <!-- LED Indicator -->
                                     <Border Grid.Column="0" Width="12" Height="12" CornerRadius="6" 
                                             Background="{Binding Status, Converter={StaticResource PluginStatusToColorConverter}}" 
                                             BorderBrush="#606060" BorderThickness="1" Margin="0,0,8,0" VerticalAlignment="Center">
                                         <Border.Effect>
                                             <DropShadowEffect BlurRadius="3" ShadowDepth="0" Color="{Binding Status, Converter={StaticResource PluginStatusToColorConverter}}" Opacity="0.8"/>
                                         </Border.Effect>
                                     </Border>
                                     
                                     <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                         <TextBlock Text="{Binding Name}" FontWeight="Bold" FontSize="12" Foreground="{StaticResource TextBrush}" TextTrimming="CharacterEllipsis"/>
                                         <TextBlock Text="{Binding Description}" FontSize="9" Foreground="{StaticResource TextBrush}" Opacity="0.7" TextWrapping="Wrap" Margin="0,1,0,0"/>
                                     </StackPanel>
                                     
                                     <Button Grid.Column="2" Content="{DynamicResource Btn_Buy}" FontWeight="Bold" Foreground="{StaticResource AccentBrush}" FontSize="9" Padding="4,1" 
                                             Visibility="{Binding IsPaid, Converter={StaticResource BoolToVisibilityConverter}}" 
                                             Click="BuyPlugin_Click" Tag="{Binding PurchaseUrl}"
                                             Margin="4,0,0,0" VerticalAlignment="Center"/>
                                 </Grid>
                             </Border>
                         </DataTemplate>
                     </ListBox.ItemTemplate>
                 </ListBox>
            </GroupBox>

            <!-- DYNAMIC CONTENT AREA -->
            <Grid Grid.Column="1">
                
                <!-- Super Macros View (Devices + Bindings) -->
                <Grid x:Name="SuperMacrosView">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="300"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <!-- Devices Panel -->
                    <GroupBox Grid.Column="0" Header="{DynamicResource Main_Devices}" Margin="4,0,4,0">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="*"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <ListBox x:Name="DeviceListBox" Grid.Row="0" SelectionChanged="DeviceListBox_SelectionChanged" Background="{StaticResource PanelBackgroundBrush}" BorderBrush="{StaticResource AccentBrush}" Foreground="{StaticResource TextBrush}">
                                <ListBox.ItemTemplate>
                                    <DataTemplate>
                                        <StackPanel Orientation="Horizontal" Margin="2">
                                             <TextBlock Text="⌨️" FontSize="16" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                             <StackPanel>
                                                 <TextBlock Text="{Binding FriendlyName}" FontWeight="SemiBold" FontSize="13" Foreground="{StaticResource TextBrush}"/>
                                                 <TextBlock Text="{Binding HardwareId}" FontSize="10" Opacity="0.6" Foreground="{StaticResource TextBrush}" TextTrimming="CharacterEllipsis" MaxWidth="180"/>
                                             </StackPanel>
                                             <Border Background="#40FF6B6B" CornerRadius="4" Padding="6,2" Margin="8,0,0,0" VerticalAlignment="Center"
                                                     Visibility="{Binding IsIntercepted, Converter={StaticResource BoolToVisibilityConverter}}">
                                                 <TextBlock Text="INT" FontSize="9" Foreground="#FFCC3333" FontWeight="Bold"/>
                                             </Border>
                                        </StackPanel>
                                    </DataTemplate>
                                </ListBox.ItemTemplate>
                            </ListBox>
                            
                            <Button x:Name="DetectDeviceButton" Grid.Row="1" Content="{DynamicResource Btn_DetectDevice}" Margin="0,4,0,0" Height="28" Click="DetectDeviceButton_Click"/>
                        </Grid>
                    </GroupBox>

                    <!-- Bindings Panel -->
                    <GroupBox Grid.Column="1" Header="{DynamicResource Main_Bindings}" Margin="4,0,0,0">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <Grid Grid.Row="0" Margin="0,0,0,12">
                               <Border Background="#10000000" CornerRadius="4" Padding="12,8" BorderBrush="#C0C0C0" BorderThickness="1">
                                   <TextBlock x:Name="TestAreaText" Text="Test Area: Press any key..." VerticalAlignment="Center" HorizontalAlignment="Center" Foreground="#555" TextTrimming="CharacterEllipsis"/>
                               </Border>
                            </Grid>

                            <ListBox x:Name="BindingsListBox" Grid.Row="1" SelectionChanged="BindingsListBox_SelectionChanged" MouseDoubleClick="BindingsListBox_MouseDoubleClick" Background="{StaticResource PanelBackgroundBrush}" BorderBrush="{StaticResource AccentBrush}" Foreground="{StaticResource TextBrush}">
                                <ListBox.ItemTemplate>
                                     <DataTemplate>
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="80"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>
                                            <Border Grid.Column="0" Background="#303030" CornerRadius="3" Padding="6,2" HorizontalAlignment="Left" BorderBrush="{StaticResource AccentBrush}" BorderThickness="1">
                                                <TextBlock Text="{Binding KeyName}" FontWeight="Bold" FontFamily="Consolas" Foreground="{StaticResource TextBrush}"/>
                                            </Border>
                                            <StackPanel Grid.Column="1" Margin="8,0,0,0" VerticalAlignment="Center">
                                                <TextBlock Text="{Binding ActionDescription}" TextTrimming="CharacterEllipsis" Foreground="{StaticResource TextBrush}"/>
                                                <TextBlock Text="{Binding DeviceName}" FontSize="10" Foreground="{StaticResource TextBrush}" Opacity="0.6"/>
                                            </StackPanel>
                                        </Grid>
                                    </DataTemplate>
                                </ListBox.ItemTemplate>
                            </ListBox>

                            <Grid Grid.Row="2" Margin="0,12,0,0">
                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                    <Button x:Name="AddBindingButton" Content="{DynamicResource Btn_Add}" Width="100" Click="AddBindingButton_Click"/>
                                    <Button x:Name="EditBindingButton" Content="{DynamicResource Btn_Edit}" Width="100" Click="EditBindingButton_Click" IsEnabled="False"/>
                                    <Button x:Name="DeleteBindingButton" Content="{DynamicResource Btn_Delete}" Width="100" Click="DeleteBindingButton_Click" IsEnabled="False"/>
                                </StackPanel>
                            </Grid>
                        </Grid>
                    </GroupBox>
                </Grid>

                <!-- Placeholder View -->
                <Border x:Name="PlaceholderView" Visibility="Collapsed" Background="{StaticResource PanelBackgroundBrush}" CornerRadius="5" BorderBrush="#909090" BorderThickness="1" Margin="8">
                    <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                        <TextBlock x:Name="PlaceholderTitle" Text="Plugin Interface" FontSize="20" FontWeight="Bold" Foreground="{StaticResource TextBrush}" HorizontalAlignment="Center"/>
                        <TextBlock Text="Configuration interface coming soon." FontSize="14" Foreground="{StaticResource TextBrush}" Opacity="0.7" Margin="0,8,0,0"/>
                    </StackPanel>
                </Border>

            </Grid>
        </Grid>
    </Grid>
</Window>
